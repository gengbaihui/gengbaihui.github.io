# ZooKeeper、Eureka、Consul 、Nacos对比

- nacos3.x 新特性 MCP和Agent支持
- nacos的作用
- nacos实际使用时配置集群吗
- 热更新？

```
A. 高可用性（High Availability）
Nacos 集群节点之间通过 Raft (CP模式) 或 Distro (AP模式) 协议同步数据。

坏掉一台没事：如果有 3 台机器，挂掉 1 台，集群依然能正常提供服务。

脑裂防护：集群能够确保数据的一致性，防止不同微服务读到不同的配置。

B. 读写性能伸缩
微服务数量多（如超过 50 个实例）时，单机 Nacos 的连接压力会非常大。集群可以将心跳检测、配置拉取的压力分散到不同节点。

C. 真正的负载均衡
生产环境通常会在 Nacos 集群前挂一个 SLB（负载均衡器，如 Nginx 或 阿里云 SLB）。

域名访问：微服务连接 nacos.yourcompany.com。

平滑升级：你可以一台台重启 Nacos 节点进行版本升级，而业务侧完全无感。

在实际开发和生产中，是否配置集群取决于你的使用场景。一句话总结：本地开发用单机，生产环境必集群。

以下是针对不同环境的配置建议和原因分析：

1. 什么时候不需要集群？（Standalone 模式）
如果你处于以下场景，单机模式完全足够：

个人学习/本地开发：在自己的电脑上运行 Docker 容器。

小微项目测试：项目对高可用要求极低，挂掉 5 分钟不影响大局。

资源极度受限：内存不足 2G，无法同时运行多个 Java 进程。

缺点：存在“单点故障”。如果运行 Nacos 的容器或服务器挂了，你的所有微服务将无法发现彼此，且无法读取配置。

2. 为什么生产环境“必配”集群？（Cluster 模式）
在正式的生产环境中，配置 Nacos 集群（通常是 3 个及以上节点）是行业标准，主要基于以下三个核心理由：

A. 高可用性（High Availability）
Nacos 集群节点之间通过 Raft (CP模式) 或 Distro (AP模式) 协议同步数据。

坏掉一台没事：如果有 3 台机器，挂掉 1 台，集群依然能正常提供服务。

脑裂防护：集群能够确保数据的一致性，防止不同微服务读到不同的配置。

B. 读写性能伸缩
微服务数量多（如超过 50 个实例）时，单机 Nacos 的连接压力会非常大。集群可以将心跳检测、配置拉取的压力分散到不同节点。

C. 真正的负载均衡
生产环境通常会在 Nacos 集群前挂一个 SLB（负载均衡器，如 Nginx 或 阿里云 SLB）。

域名访问：微服务连接 nacos.yourcompany.com。

平滑升级：你可以一台台重启 Nacos 节点进行版本升级，而业务侧完全无感。

3. Nacos 3.x 集群配置的关键变化
如果你使用的是 Nacos 3.1.1，集群配置有几个新要点：

节点数量：必须是 奇数（3, 5, 7...），因为 Raft 协议需要“过半数”选主。

端口要求：除了 8848，必须同时开放 9848 和 9849（gRPC 端口），否则集群节点之间无法通信。

共享数据库：集群模式下严禁使用嵌入式数据库 Derby，必须配置所有节点连接同一个 MySQL 实例（通常也是高可用的 MySQL）。

鉴权密钥一致性：所有节点的 NACOS_AUTH_TOKEN_SECRET_KEY 必须完全相同，否则 Token 无法跨节点校验。

```

集群如何配置

如果你准备上线生产：

必须配置集群（至少3个节点）。

必须使用外置 MySQL，并做好数据库备份。

必须开启鉴权，修改默认密码。
